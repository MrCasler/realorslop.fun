{% extends 'base.html' %}

{% block title %}Home - Real or Slop{% endblock %}


{% block content %}

<!--<pre>{{ game_data }}</pre> -->

<section class="" id="gameloop">
    <div class="container mx-auto px-4">

    <h4 id="gameloop-subheading" class="text-2xl " > Guess which image is real</h4>

    <div class="container mx-auto px-4">
        
        <p> if you get it wrong, the game will explain why it is AI-generated.</p>
    </div>

<div 
  x-data='{
    leftImage: {{ game_data.left_image | tojson }},
    rightImage: {{ game_data.right_image | tojson }},
    isLeftReal: {{ game_data.is_left_real | tojson }},
    explanation: {{ game_data.explanation | tojson }},
    score: 0, lives: 3, feedback: "", locked: false,

    async nextRound() {
      if (this.lives <= 0) {
        this.feedback = `ðŸ’€ Game Over! Final score: ${this.score}`;
        return;
      }
      try {
        const response = await fetch("/api/next");
        const data = await response.json();
        this.leftImage = data.left_image;
        this.rightImage = data.right_image;
        this.isLeftReal = data.is_left_real;
        this.explanation = data.explanation;
        this.feedback = "";
      } catch (error) {
        console.error("Error fetching next round data:", error);
      } finally {
        this.locked = false;
      }
    },

    async guess(side) {
    if (this.locked) return;
      const correct = (side === "left" && this.isLeftReal) || (side === "right" && !this.isLeftReal);
      if (correct) {
        this.score++;
        this.feedback = "âœ… Correct! Great Job! ðŸ˜Š";
      } else {
        this.lives--; this.lives = Math.max(this.lives, 0);
        this.feedback = "âŒ Wrong! "     + this.explanation;
      }

      if (this.lives <= 0) {
        this.feedback = `ðŸ’€ Game Over! Final score: ${this.score}`;
        return;
      }
        this.locked = true;
        setTimeout(() => this.nextRound(), 3000);
    }
  }'
  class="container mx-auto px-4"
>

        <div class="mb-4">
            <p class="text-lg font-semibold">Score: <span x-text="score"></span></p>
            <p class="text-lg font-semibold">Lives: <span x-text="lives"></span></p>
            <p class="text-xl mt-2" x-text="feedback"></p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-stretch">
            <div class="rounded overflow-hidden bg-gray-50">
                <img :src="leftImage" @click="guess('left')" alt="Left Image" class="" loading="lazy">
            </div>
            <div class="rounded overflow-hidden bg-gray-50">
                <img :src="rightImage" @click="guess('right')" alt="Right Image" class="" loading="lazy">
            </div>
        </div>
    </div>
</section>
{% endblock %}
